@app.route('/download_results', methods=['POST'])
def download_results():
    drug_name = request.json.get('drug_name')
    if not drug_name:
        return jsonify({'error': 'No drug name provided'}), 400

    # Check if the drug class data is cached
    if drug_name not in class_cache:
        return jsonify({'error': 'Drug class data not found'}), 404

    drug_class_data = class_cache[drug_name]

    # Create an Excel workbook and sheet
    wb = Workbook()
    ws = wb.active
    ws.title = "Drug Class Results"

    # Add headers
    ws.append(["Drug Name", "Class Type", "Classes"])

    # Add data
    for class_type, classes in drug_class_data['classes'].items():
        for cls in classes:
            ws.append([drug_name, class_type, cls])

    # Save workbook to a BytesIO buffer
    buffer = BytesIO()
    wb.save(buffer)
    buffer.seek(0)

    return send_file(buffer, download_name=f'{drug_name}_drug_class_results.xlsx', as_attachment=True)

if __name__ == '__main__':
    app.run(debug=True)

